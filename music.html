<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listen Around the World - Music List</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <a href="index.html" class="back-link">Back to Gallery</a>
    <h1 class="main-title">Music I've Listened To</h1>

    <div class="stat-display">
        <span id="statText">0 records from 0 countries</span>
    </div>

    <p class="subtitle">A list of music entries organized by country</p>

    <nav class="filter-bar">
        <div class="filter-group sort">
            <label for="sortFilter">Sort</label>
            <select id="sortFilter">
                <option value="alpha">Country Aâ€“Z</option>
                <option value="date">National Day</option>
            </select>
        </div>

        <div class="filter-group continent">
            <label for="continentFilter">Continent</label>
            <select id="continentFilter">
                <option value="all">All</option>
                <option value="Africa">Africa</option>
                <option value="Asia">Asia</option>
                <option value="Europe">Europe</option>
                <option value="North America">North America</option>
                <option value="South America">South America</option>
                <option value="Oceania">Oceania</option>
            </select>
        </div>

        <div class="filter-group search">
            <label for="searchInput">Search</label>
            <input type="text" id="searchInput" placeholder="Find a country, artist or album...">
        </div>
    </nav>

    <div class="container">
        <div id="musicList" class="music-list"></div>
    </div>

    <script src="script.js"></script>
    <script>
        // Music page rendering
        let musicSearchEl;
        let musicContinentEl;
        let musicSortEl;

        function setupMusicFilters() {
            musicSearchEl = document.getElementById("searchInput");
            musicContinentEl = document.getElementById("continentFilter");
            musicSortEl = document.getElementById("sortFilter");

            if (musicSearchEl) musicSearchEl.addEventListener("input", renderMusic);
            if (musicContinentEl) musicContinentEl.addEventListener("change", renderMusic);
            if (musicSortEl) musicSortEl.addEventListener("change", renderMusic);
        }

        function renderMusic() {
            const musicListEl = document.getElementById("musicList");
            if (!musicListEl) return;

            musicListEl.innerHTML = "";

            const search = musicSearchEl?.value.toLowerCase() || "";
            const continent = musicContinentEl?.value || "all";
            const sortMode = musicSortEl?.value || "alpha";

            const musicItems = countriesData.filter(c =>
                c.music &&
                c.music.length > 0 &&
                (search === "" || c.name.toLowerCase().includes(search) || 
                 c.music.some(m => 
                    (m.artist?.toLowerCase().includes(search)) ||
                    (m.album_or_playlist?.toLowerCase().includes(search)) ||
                    (m.description?.toLowerCase().includes(search))
                 )
                ) &&
                (continent === "all" || c.continent === continent)
            );

            if (musicItems.length === 0) {
                musicListEl.innerHTML = '<div class="empty-state">No music recorded yet.</div>';
                updateStats(countriesData, 'music');
                return;
            }

            // Flatten music entries with country info
            let flatMusic = [];
            musicItems.forEach(country => {
                country.music.forEach(m => {
                    flatMusic.push({
                        ...m,
                        countryName: country.name,
                        countryCode: country.code,
                        type: country.type
                    });
                });
            });

            // Sort
            if (sortMode === "date") {
                flatMusic.sort((a, b) => {
                    const aDate = a.date || "99-99";
                    const bDate = b.date || "99-99";
                    return aDate.localeCompare(bDate);
                });
            } else {
                // A-Z: countries first, then territories
                flatMusic.sort((a, b) => {
                    if (a.type !== b.type) {
                        return a.type === 'country' ? -1 : 1;  // countries before territories
                    }
                    return a.countryName.localeCompare(b.countryName);
                });
            }

            // Render
            flatMusic.forEach(entry => {
                const item = document.createElement("div");
                item.classList.add("music-item");

                const flagDiv = document.createElement("div");
                flagDiv.classList.add("flag-thumbnail");
                const img = document.createElement("img");
                if (entry.countryCode && (entry.countryCode.includes("/") || entry.countryCode.startsWith("http"))) {
                    img.src = entry.countryCode;
                } else if (entry.countryCode) {
                    img.src = `https://flagcdn.com/w160/${entry.countryCode}.png`;
                }
                img.alt = `Flag of ${entry.countryName}`;
                flagDiv.appendChild(img);

                const details = document.createElement("div");
                details.classList.add("music-details");

                const countryName = document.createElement("div");
                countryName.classList.add("country-name");
                countryName.textContent = entry.countryName;
                details.appendChild(countryName);

                const artist = document.createElement("div");
                artist.classList.add("music-artist");
                artist.textContent = entry.artist || "";
                details.appendChild(artist);

                const album = document.createElement("div");
                album.classList.add("music-album");
                if (entry.url) {
                    const a = document.createElement("a");
                    a.href = entry.url;
                    a.target = "_blank";
                    a.rel = "noopener noreferrer";
                    a.textContent = entry.album_or_playlist || "Listen";
                    album.appendChild(a);
                } else {
                    album.textContent = entry.album_or_playlist || "";
                }
                details.appendChild(album);

                if (entry.description) {
                    const desc = document.createElement("div");
                    desc.classList.add("music-desc");
                    desc.textContent = entry.description;
                    details.appendChild(desc);
                }

                if (entry.date) {
                    const dateEl = document.createElement("div");
                    dateEl.classList.add("music-date");
                    // Format DD-MM to DD-MMM
                    const [day, month] = entry.date.split("-");
                    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                    const monthIndex = parseInt(month) - 1;
                    const formatted = `${day}-${monthNames[monthIndex]}`;
                    dateEl.textContent = `National day: ${formatted}`;
                    details.appendChild(dateEl);
                }

                item.appendChild(flagDiv);
                item.appendChild(details);
                musicListEl.appendChild(item);
            });

            updateStats(countriesData, 'music');
        }
    </script>

</body>
</html>
